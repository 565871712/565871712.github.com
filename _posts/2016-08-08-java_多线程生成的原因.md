---
layout: post
title:  Java 多线程生成的原因
date:  2016-08-08 13:50:39
categories: java

---


#### Java 多线程生成的原因

***线程之间的共享变量存储在主内存（main memory）中，每个线程都有一个私有的本地内存（local memory），本地内存中存储了该线程以读/写共享变量的副本。***

本地内存是JMM（Java内存模型）的一个抽象概念，并不真实存在。它涵盖了缓存，写 缓冲区，寄存器以及其 他的硬件和编译器优化。Java内存模型的抽象示意图如下图：
![](https://cloud.githubusercontent.com/assets/9150767/13448138/81f142d6-e05b-11e5-8534-c2f383b5497d.png)

##### i++操作实质

对于一个简单的 i＋＋ 操作，结合上图1 ，会发生如下的步骤：

1. read：作用于主内存中，把主内存中一个变量的值传输到 工作内存 中。
2. load：作用于工作内存，把从read 操作从主内存中得到的值放入到工作内存的副本中。
3. use：把工作内存中的该副本值传递给执行引擎（也就是操作数栈中）。
4. assign：作用于工作内存，把执行引擎执行后的新值传递给该工作内存的变量。
5. store：作用于工作内存，把工作内存中该变量的值传送到 主内存中去。
6. write：作用于主内存的变量，把store 操作 得到的值写入到 主内存的该变量中。

所以说，一个 i++操作并不是原子性的。这上述的这些步骤中，可能会有其他线程对主内存的变量进行操作，从而导致出现多线程问题。

写在最后

1. 写出来，说出来才知道对不对，知道不对才能改正，改正了才能成长。
2. 在技术方面，希望大家眼里都容不得沙子。如果有不对的地方或者需要改进的地方希望可以指出，万分感谢